<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chatbot RISDA</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" />

    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            background: #fff;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .search-container {
            max-width: 600px;
            width: 100%;
        }

        h2 {
            font-weight: 500;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
            /* color: #222; */
        }

        .input-group {
            border-radius: 1.5rem;
            border: 1px solid #ddd;
            padding: 0.25rem 0.75rem;
            background: #fff;
            box-shadow: 0 0 6px rgb(0 0 0 / 0.05);
        }

        .input-group .form-control {
            border: none;
            border-radius: 1.5rem;
            padding-left: 0.5rem;
            font-size: 1rem;
            outline-offset: 2px;
        }

        .input-group .form-control:focus {
            box-shadow: none;
            outline: none;
        }

        .btn-tool {
            background: transparent;
            border: none;
            color: #444;
            font-size: 1.1rem;
            padding: 0 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .btn-tool:hover,
        .btn-tool:focus {
            color: #000;
            text-decoration: none;
            outline: none;
            box-shadow: none;
        }

        .btn-submit {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #000;
            border: none;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.15s ease-in-out;
        }

        .btn-submit:hover,
        .btn-submit:focus {
            background-color: #222;
            outline: none;
            box-shadow: none;
        }

        /* Icon placeholders from Bootstrap Icons CDN */
        .icon {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .suggestions-wrapper {
            position: relative;
            /* Make this the anchor */
            width: 100%;
            max-width: 600px;
        }

        .suggestions-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .suggestions-list {
            position: absolute;
            width: 100%;
            border-radius: 0.75rem;
            background-color: #f8f9fa;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        /* Default: show below */
        .suggestions-wrapper.suggest-below .suggestions-list {
            top: 100%;
            margin-top: 0.75rem;
        }

        /* If chatbox exists: show above */
        .suggestions-wrapper.suggest-above .suggestions-list {
            bottom: 100%;
            margin-bottom: 0.75rem;
        }



        .suggestion-item {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            color: #444;
            cursor: pointer;
            transition: background-color 0.15s ease-in-out;
            user-select: none;
            word-break: break-word;
        }

        .suggestion-item strong {
            font-weight: 600;
            color: #666;
        }

        .suggestion-item:not(:last-child) {
            border-bottom: 1px solid #e1e3e6;
        }

        .suggestion-item:hover,
        .suggestion-item:focus {
            background-color: #e9ecef;
            outline: none;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            h2 {
                font-size: 1.25rem;
            }

            .input-group .form-control {
                font-size: 0.95rem;
            }

            .suggestion-item {
                font-size: 0.85rem;
            }
        }

        .search-container {
            display: flex;
            flex-direction: column;
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem;
            height: 90vh;
        }

        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            /* background: #f9f9f9; */
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
        }

        .chat-user {
            justify-content: flex-end;
        }

        .chat-bot {
            justify-content: flex-start;
        }

        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 75%;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .chat-user .chat-bubble {
            background-color: #1976d2;
            color: #fff;
            border-top-right-radius: 0;
            transition: background-color 0.3s;
        }

        .chat-bot .chat-bubble {
            background-color: #f1f1f1;
            color: #333;
            border-top-left-radius: 0;
            transition: background-color 0.3s;
        }

        .btn-submit i {
            transition: transform 0.2s ease;
        }

        .btn-submit:hover i {
            transform: scale(1.2);
        }

        .input-wrapper {
            position: sticky;
            bottom: 0;
            background: white;
            padding-top: 0.5rem;
        }

        .suggestion-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
        }

        .suggestion-item:hover,
        .suggestion-item:focus {
            background-color: #f0f0f0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }

        .typing::after {
            content: '|';
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Optional enhancements */
        .chat-box::-webkit-scrollbar {
            width: 8px;
        }

        .chat-box::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .chat-box::-webkit-scrollbar-track {
            background-color: transparent;
        }

        :root {
            --bg-light: #ffffff;
            --bg-dark: #000000;
            --text-light: #000000;
            --text-dark: #ffffff;
            --input-bg-dark: #333;
            --input-border: #ccccce;
        }

        body.light-mode {
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        body {
            transition: background 0.8s ease-in-out, color 0.4s ease;
            background: linear-gradient(135deg, #f0f0f0, #ffffff);
            color: #000000;
        }

        .dark-mode {
            background: linear-gradient(135deg, #1e1e1e, #2e2e2e);
            color: #ffffff;
        }

        body {
            transition: background 0.4s ease-in-out, color 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .light-mode {
            background: #ffffff;
            color: #111;
        }

        .dark-mode {
            background: #121212;
            color: #eee;
        }

        /* Overlay for rotation animation */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, #000 30%, transparent 70%);
            transform: rotate(0deg) scale(0);
            transform-origin: center;
            transition: transform 0.8s ease-in-out;
            z-index: 999;
            pointer-events: none;
            border-radius: 50%;
            opacity: 0.3;
        }

        /* Trigger clockwise spin on theme toggle */
        body.dark-mode::before {
            background: radial-gradient(circle at center, #fff 30%, transparent 70%);
            transform: rotate(360deg) scale(1.5);
        }

        .light-mode {
            background-color: #ffffff;
            color: #000000;
        }

        #themeToggle {
            transition: transform 0.3s ease;
        }

        #themeToggle:active {
            transform: rotate(360deg);
        }

        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .search-input-wrapper {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border-radius: 1.5rem;
            padding: 0.25rem 0.5rem;
            gap: 0.75rem;
            border: 1px solid var(--input-border);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .search-input-wrapper {
            background-color: var(--input-bg-dark);
            border: 1px solid #555;
        }

        .chat-container {
            max-width: 600px;
        }

        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 20px;
            margin-bottom: 0.5rem;
            display: inline-block;
            max-width: 80%;
        }

        .user-message {
            background-color: #0d6efd;
            color: white;
            align-self: flex-end;
            text-align: right;
        }

        .bot-message {
            background-color: #f1f1f1;
            color: #000;
            text-align: left;
        }
    </style>
</head>

<body>
    <div class="search-container">

        <div class="d-flex justify-content-end align-items-center gap-2 my-3">
            <button id="langToggle" class="btn btn-sm btn-outline-primary">BM</button>
            <button id="themeToggle" class="btn btn-sm btn-outline-dark">🌙</button>
        </div>
        <h2 id="titleText" class="d-block">Tanya RISDA – Kami sedia membantu!</h2>
        <div id="chatBox" class="chat-box mt-4 d-none">
            <!-- Chat messages will go here -->
        </div>
        <form id="searchForm" class="d-flex align-items-center input-group" autocomplete="off" role="search"
            aria-label="Search form">
            <div class="suggestions-wrapper">
                <div class="d-flex">
                    <input id="searchInput" type="text" class="form-control ps-3"
                        placeholder="Contoh: Apa itu program Tanam Semula RISDA?" aria-label="Search input"
                        name="query" />

                    <button type="button" class="btn-submit ms-2" aria-label="Submit search" title="Submit search">
                        <i class="fa-solid fa-circle-arrow-up"></i>
                    </button>
                </div>

                <div id="suggestions" class="suggestions-list" role="list" aria-label="Search suggestions">
                    <!-- Suggestions here -->
                </div>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS Bundle CDN (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const chatBox = document.getElementById("chatBox");
        const userInput = document.getElementById('userInput');
        const submitBtn = document.querySelector('.btn-submit');
        const langToggle = document.getElementById('langToggle');
        const themeToggle = document.getElementById('themeToggle');
        const titleText = document.getElementById('titleText');
        const searchInput = document.getElementById("searchInput");
        const suggestionsBox = document.getElementById("suggestions");
        const wrapper = document.querySelector('.suggestions-wrapper');

        let currentLang = 'bm';
        let isDark = false;

        const translations = {
            title: {
                bm: 'Tanya RISDA – Kami sedia membantu!',
                en: 'Ask RISDA – We’re ready to help!'
            },
            placeholder: {
                bm: 'Contoh: Apa itu program Tanam Semula RISDA?',
                en: 'Example: What is the RISDA Replanting Program?'
            },
            noSuggestion: {
                bm: 'Tiada cadangan ditemui',
                en: 'No suggestions found'
            },
            notFound: {
                bm: 'Maaf saya tiada jawapan untuk itu.',
                en: "Sorry, I don't have answer for that."
            }
        };

        const data = [
            {
                soalan: {
                    bm: "Apa itu program Tanam Semula RISDA?",
                    en: "What is the RISDA Replanting Program?"
                },
                jawapan: {
                    bm: "Program bantuan Tanam Semula pokok getah tua yang tidak ekonomik dengan pokok getah baharu.",
                    en: "A replanting assistance program for old, uneconomical rubber trees to be replanted with new rubber."
                }
            },
            {
                soalan: {
                    bm: "Siapa boleh mohon?",
                    en: "Who is eligible to apply?"
                },
                jawapan: {
                    bm: "Pekebun kecil yang ada tanah sendiri, maksimum 40 hektar.",
                    en: "Smallholders who own their own land, up to a maximum of 40 hectares."
                }
            },
            {
                soalan: {
                    bm: "Tanah sewa boleh mohon tak?",
                    en: "Can I apply with rented land?"
                },
                jawapan: {
                    bm: "Tak boleh. Mesti tanah milik sendiri atau milik waris.",
                    en: "No. The land must be owned by the applicant or legally inherited with documentation."
                }
            },
            {
                soalan: {
                    bm: "Umur pokok mesti berapa untuk mohon?",
                    en: "What is the required age of trees to apply?"
                },
                jawapan: {
                    bm: "Lebih 20 tahun atau pokok dah tak ada hasil.",
                    en: "Over 20 years old or trees that no longer produce yield."
                }
            },
            {
                soalan: {
                    bm: "Apa dokumen kena sediakan?",
                    en: "What documents are required?"
                },
                jawapan: {
                    bm: `
- Kad pengenalan (salinan), 
- Geran tanah, 
- Borang permohonan.`,
                    en: `
- Copy of identity card, 
- Land grant, 
- Application form.`
                }
            },
            {
                soalan: {
                    bm: "Berapa bantuan yang dapat?",
                    en: "How much assistance is provided?"
                },
                jawapan: {
                    bm: `
- 13,710 sehektar bagi Semenanjung, 
- 14,805 bagi Negeri Sarawak, 
- 14,955 bagi Negeri Sabah.`,
                    en: `
- 13,710 per hectare for Peninsular, 
- 14,805 per hectare for Sarawak, 
- 14,955 per hectare for Sabah.`
                }
            },
            {
                soalan: {
                    bm: "Macam mana nak mohon?",
                    en: "How do I apply?"
                },
                jawapan: {
                    bm: "Datang ke Pejabat RISDA terdekat atau tanya pegawai kawasan atau layari laman web risda.gov.my.",
                    en: "Visit the nearest RISDA office or contact a RISDA officer and visit the website risda.gov.my."
                }
            },
            {
                soalan: {
                    bm: "Lepas mohon, siapa pantau?",
                    en: "After applying, who will monitor?"
                },
                jawapan: {
                    bm: "Pegawai RISDA akan datang tengok kebun dan bantu sampai siap tanam.",
                    en: "RISDA officers will visit the farm and guide the process."
                }
            },
            {
                soalan: {
                    bm: "Berapa luas tanah minimum boleh mohon?",
                    en: "What is the minimum land size to apply?"
                },
                jawapan: {
                    bm: "Sekurang-kurangnya 0.1 hektar.",
                    en: "At least 0.1 hectare."
                }
            },
            {
                soalan: {
                    bm: "Ada syarat-syarat tak? Apa syaratnya?",
                    en: "Are there any conditions? What are they?"
                },
                jawapan: {
                    bm: `Ada. Syarat-syaratnya adalah: 
- Warganegara Malaysia, 
- Pekebun kecil/waris/pemegang amanah yang memiliki tanah kurang dari 40 hektar, 
- Memiliki geran yang sah.`,
                    en: `Yes. Conditions include: 
- Must be a Malaysian citizen, 
- Smallholder/heir/trustee owning less than 40 hectares of land, 
- Must have a valid land grant.`
                }
            },
            {
                soalan: {
                    bm: "Kena bayar apa-apa tak bila mohon?",
                    en: "Do I need to pay anything when applying?"
                },
                jawapan: {
                    bm: "Tiada bayaran dikenakan. RISDA memberi BANTUAN bukan PINJAMAN.",
                    en: "No payment is required. RISDA provides ASSISTANCE, not a LOAN."
                }
            },
            {
                soalan: {
                    bm: "Lepas lulus, bila bantuan mula dapat?",
                    en: "After approval, when will the assistance be received?"
                },
                jawapan: {
                    bm: `Bantuan RISDA disalurkan mengikut ansuran: 
- Ansuran 1 - RM7,710, 
- Ansuran 2 - RM1,600, 
- Ansuran 3 - RM1,300, 
- Ansuran 4 - RM1,400, 
- Ansuran 5 - RM1,700. 
                    Setelah permohonan diluluskan, pekebun haruslah membersihkan kebun untuk melayakkan mendapat bantuan tolak/tebang membersihkan kebun , benih pokok , baja dan racun. Setelah benih ditanam, pekebun kecil akan mendapatkan bantuan siap tanam.`,
                    en: `RISDA assistance is disbursed in instalments: 
- Instalment 1 - RM7,710, 
- Instalment 2 - RM1,600, 
- Instalment 3 - RM1,300, 
- Instalment 4 - RM1,400, 
- Instalment 5 - RM1,700. 
                    Once the application is approved, the smallholder must clear the land to qualify for initial assistance, which includes felling/clearing the land, tree seedlings, fertilisers, and pesticides. After the seedlings are planted, the smallholder will receive the planting completion assistance.`
                }
            },
            {
                soalan: {
                    bm: "Boleh tanam pokok lain selain getah?",
                    en: "Can I plant other trees besides rubber?"
                },
                jawapan: {
                    bm: "Tidak boleh tapi sekarang RISDA ada PROGRAM TANAM SEMULA GETAH SECARA INTEGRASI.",
                    en: "No, but RISDA now offers a Rubber Replanting Program with Integrated Farming."
                }
            },
            {
                soalan: {
                    bm: "Tanam Semula Getah Secara Integrasi (TSG-i)? Macam mana tu?",
                    en: "Rubber Replanting with Integrated Farming (TSG-i)? How does that work?"
                },
                jawapan: {
                    bm: "TSG-i adalah getah ditanam secara bercampur dengan tanaman kekal yang sesuai dengan syarat-syarat tanaman.",
                    en: "TSG-i is rubber planted together with permanent crops that comply with planting conditions."
                }
            },
            {
                soalan: {
                    bm: "Apa syarat TSG-i?",
                    en: "What are the conditions for TSG-i?"
                },
                jawapan: {
                    bm: `
- Menyertai tanam semula mulai 2024
- Pendekatan secara individu
- Pokok getah mesti ditanam dan hidup subur
- Syarat kelayakan sama seperti Program Tanam Semula Getah
- Tanaman kekal lain mesti seperti disyorkan
- Tanda tangan Surat Akujanji Penyertaan TSG-i`,
                    en: `
- Participate in replanting from 2024
- Individual-based approach
- Rubber trees must be planted and healthy
- Same eligibility as Rubber Replanting Program
- Other permanent crops must follow guidelines
- Sign Letter of Undertaking for TSG-i`
                }
            },
            {
                soalan: {
                    bm: "Apa jenis tanaman kekal yang dibenarkan?",
                    en: "What types of permanent crops are allowed?"
                },
                jawapan: {
                    bm: "Durian, Cempedak, Nangka, Duku, Langsat dan Kelapa.",
                    en: "Durian, Cempedak, Jackfruit, Duku, Langsat, and Coconut."
                }
            },
            {
                soalan: {
                    bm: "Sekiranya kebun tidak berjaya adakah RISDA akan bantu?",
                    en: "If the plantation fails, will RISDA provide assistance?"
                },
                jawapan: {
                    bm: "Ya, RISDA akan bantu melalui Program Rancangan Pemulihan Kebun.",
                    en: "Yes, RISDA will provide assistance through the Farm Recovery Program."
                }
            },
            {
                soalan: {
                    bm: "Ada latihan untuk peserta?",
                    en: "Is there training for participants?"
                },
                jawapan: {
                    bm: "Ya, RISDA ada bagi kursus dan latihan cara tanam dan jaga pokok. Pegawai lapangan juga akan memantau kebun.",
                    en: "Yes, RISDA provides courses and training on how to plant and care for the trees. Field officers will also monitor the plantation."
                }
            },
            {
                soalan: {
                    bm: "Boleh mohon atas nama suami/isteri?",
                    en: "Can I apply under my husband’s/wife’s name?"
                },
                jawapan: {
                    bm: "Boleh, tapi kena ada bukti milikan bersama atau surat kebenaran.",
                    en: "Yes, but you must have proof of joint ownership or a letter of consent."
                }
            },
            {
                soalan: {
                    bm: "Apakah BMT?",
                    en: "What is BMT"
                },
                jawapan: {
                    bm: "BMT ialah bantuan tunai tahunan sebanyak RM800, diberikan kepada pekebun kecil dan penoreh getah yang terjejas pendapatan semasa musim tengkujuh.",
                    en: "BMT is an annual cash aid of RM800, given to smallholders and rubber tappers whose income is affected during the monsoon season."
                }
            },
            {
                soalan: {
                    bm: "Siapakah layak menerima BMT?",
                    en: "Who is eligible to receive BMT (Monsoon Season Aid)?"
                },
                jawapan: {
                    bm: `Pekebun Kecil Getah (Pemilik Tanah)
- Warganegara Malaysia sahaja.
- Pekebun kecil yang berdaftar dengan RISDA.
- Memiliki jumlah keluasan milikan tanah 0.1 hingga 2.5 hektar secara agregat.
- Pemilik tanah yang sah.
- Satu lot hanya seorang penerima sahaja (tanpa mengambil kira bilangan ahli kongsi).
- Seorang pekebun kecil hanya layak menerima bantuan sekali sahaja.

Penoreh Getah
- Warganegara Malaysia.
- Penoreh yang berdaftar dengan RISDA.
- Menoreh di lot berkeluasan 0.1 hingga 2.5 hektar.
- Mendapat pengesahan daripada pemilik tanah / wakil yang sah.
- Mempunyai Kad Permit Autoriti Getah (PAT-G) atau Slip Pengaktifan PAT-G yang masih sah ketika permohonan dibuat.
- Satu lot hanya seorang penerima bantuan sahaja.
- Seorang penoreh hanya layak menerima bantuan sekali sahaja.`,
                    en: `Rubber Smallholder (Landowner)
- Malaysian citizen only.
- Smallholder registered with RISDA.
- Owns land with a total area between 0.1 to 2.5 hectares (aggregate).
- Must be the legal landowner.
- Only one recipient per land lot, regardless of the number of co-owners.
- A smallholder is only eligible to receive the aid once.

Rubber Tapper
- Must be a Malaysian citizen.
- Must be a rubber tapper registered with RISDA.
- Tapping on a land lot with an area between 0.1 to 2.5 hectares.
- Must obtain verification from the landowner or authorized representative.
- Must possess a valid Rubber Authority Permit Card (PAT-G) or a valid PAT-G Activation Slip at the time of application.
- Only one recipient per land lot is allowed.
- A rubber tapper is eligible to receive the aid only once.`
                }
            },
            {
                soalan: {
                    bm: "Cara Permohonan",
                    en: "Application Method"
                },
                jawapan: {
                    bm: `
- Online melalui Portal Pekebun Kecil RISDA: https://pekebunkecil.risda.gov.my 
- Manual: lawat ke Pejabat RISDA daerah`,
                    en: `You can apply through: 
- Online: Via the RISDA Smallholders Portal: 🔗 https://pekebunkecil.risda.gov.my
- Manual: Visit the nearest district RISDA office`
                }
            },
            {
                soalan: {
                    bm: "Bilakah tarikh permohonan",
                    en: "When is the application date?"
                },
                jawapan: {
                    bm: `
- Sila rujuk di Portal Pekebun Kecil RISDA:
https://pekebunkecil.risda.gov.my
- Manual: lawat ke Pejabat RISDA daerah/jajahan`,
                    en: `Online Application:
- Via the RISDA Smallholder Portal: 🔗 https://pekebunkecil.risda.gov.my 
                    Manual Application: 
- Visit the nearest RISDA district or regional office`
                }
            },
            {
                soalan: {
                    bm: "Berapakah kadar bantuan ini?",
                    en: "What is the amount of this assistance?"
                },
                jawapan: {
                    bm: "Kadar bantuan sebanyak RM800 seorang kepada setiap penerima yang layak.",
                    en: "The assistance amount is RM800 per person for each eligible recipient."
                }
            },
            {
                soalan: {
                    bm: "Macam mana nak jadi ushawan RISDA?",
                    en: "How can I become a RISDA entrepreneur?"
                },
                jawapan: {
                    bm: `
- Pekebun kecil (pemilik tanah).
- Ahli isi rumah (AIR) pekebun kecil. 
- Warganegara Malaysia. 
- Berdaftar dengan RISDA.
- Miliki tanah getah seluas 0.1 hingga 40 hektar. 
- Pemilik sah.`,
                    en: `
- Smallholder (landowner)
- Household member (AIR) of a smallholder
- Malaysian citizen
- Registered with RISDA
- Owns rubber land between 0.1 to 40 hectares
- Legitimate owner`
                }
            },
            {
                soalan: {
                    bm: "Apakah bantuan usahwan yang diberi?",
                    en: "What types of assistance are provided to entrepreneurs?"
                },
                jawapan: {
                    bm: `AET Start‑Up: sehingga RM10,000 untuk perniagaan baru (< 3 tahun & jualan <RM60k)\n\nAET Nano: sehingga RM20,000 untuk perniagaan dengan jualan RM60k–150k\n\nAET Belia: sehingga RM15,000 (RM5k untuk latihan + RM10k modal/peralatan)\n\nGroom Big / Usahawan Mikro: geran hingga RM50,000 bagi usahawan yang berpotensi mencapai jualan tinggi & memiliki premis perniagaan\n\nBantuan lain:\n- Program pemasaran RisSMart (percubaan tiga bulan di premis RISDA)\n- Kursus sijil halal\n- Sistem penjenamaan & pembungkusan`,
                    en: `AET Start-Up: up to RM10,000 for new businesses (less than 3 years old & sales below RM60,000).\n\nAET Nano: up to RM20,000 for businesses with sales between RM60,000–150,000\n\nAET Youth: up to RM15,000 (RM5,000 for training + RM10,000 for capital/equipment)\n\nGroom Big / Micro Entrepreneur: grants up to RM50,000 for entrepreneurs with high sales potential and a business premise\n\nOther assistance:\n- RisSMart marketing program (three-month trial at RISDA premises)\n- Halal certification courses\n- Branding and packaging system`
                }
            },
            {
                soalan: {
                    bm: "Proses permohonan bantuan usahawan",
                    en: "Entrepreneurial assistance application process"
                },
                jawapan: {
                    bm: `
- E-Rekrutmen: daftar dan jalani tapisan dalam talian.
- Sediakan dokumen: termasuk Borang AET, surat akuan, kertas kerja projek, rancangan perniagaan.
- Temujanji atau lawatan tapak oleh RISDA selepas penilaian awal
- Keputusan & penyaluran: bantuan modal atau geran dikredit terus ke akaun setelah lulus`,
                    en: `
                    Entrepreneurial Assistance Application Process
- E-Recruitment: Register and undergo online screening.
- Prepare Documents: Including the AET Form, statutory declaration letter, project paper, and business plan.
- Appointment or Site Visit: Conducted by RISDA after initial evaluation.
- Decision & Disbursement: Capital assistance or grants will be credited directly into the account upon approval.`
                }
            },
            {
                soalan: {
                    bm: "Untuk mengetahui maklumat lanjut",
                    en: "To learn more information"
                },
                jawapan: {
                    bm: `
- Pejabat Pembangunan Usahawan RISDA, KL: tel +603‑4256 4022
- Pejabat RISDA negeri/jajahan: hubungi terus untuk temujanji dan taklimat.`,
                    en: `
- Visit the RISDA Smallholders Portal: https://pekebunkecil.risda.gov.my 
- Or go to the nearest RISDA district office`
                }
            }
        ];

        let fuse;

        function initFuse(data) {
            const fuseOptions = {
                keys: [`soalan.${currentLang}`],
                threshold: 0.5,
            };
            console.log("Fuse language key:", fuseOptions.keys[0]);
            fuse = new Fuse(data, fuseOptions);
        }

        langToggle.addEventListener('click', () => {
            currentLang = currentLang === 'bm' ? 'en' : 'bm';
            langToggle.innerText = currentLang === 'bm' ? 'BM' : 'EN';
            titleText.innerText = translations.title[currentLang];
            searchInput.placeholder = translations.placeholder[currentLang];
            initFuse(data);
        });

        themeToggle.addEventListener('click', () => {
            isDark = !isDark;
            document.body.classList.toggle('dark-mode', isDark);
            document.body.classList.toggle('light-mode', !isDark);
            themeToggle.innerText = isDark ? '☀️' : '🌙';
        });

        initFuse(data);

        function addChatMessage(sender, message) {
            chatBox.classList.remove("d-none");
            // titleText.classList.add("d-none");
            wrapper.classList.add('suggest-above');
            wrapper.classList.remove('suggest-below');
            const messageDiv = document.createElement("div");
            messageDiv.className = `chat-message chat-${sender} fade-in`;

            const bubble = document.createElement("div");
            bubble.className = "chat-bubble";
            if (sender === "bot") {
                bubble.classList.add("typing");
                messageDiv.appendChild(bubble);
                chatBox.appendChild(messageDiv);

                // Detect if message contains bullet-style (- ) content
                let formattedMessage = message;
                if (message.includes("-")) {
                    const lines = message.split('\n');
                    let ul = "<ul>";
                    lines.forEach(line => {
                        if (line.trim().startsWith("-")) {
                            ul += `<li>${line.replace(/^-\s*/, "").trim()}</li>`;
                        } else if (line.trim() !== "") {
                            ul += `</ul><p>${line.trim()}</p><ul>`;
                        }
                    });
                    ul += "</ul>";
                    formattedMessage = ul;
                } else {
                    // If no dash bullets, escape plain text
                    formattedMessage = `<p>${message}</p>`;
                }

                bubble.innerHTML = ""; // Clear existing content
                let index = 0;
                const typingChars = formattedMessage;
                const typeInterval = setInterval(() => {
                    bubble.innerHTML = typingChars.slice(0, index);
                    index++;
                    chatBox.scrollTop = chatBox.scrollHeight;
                    if (index >= typingChars.length) {
                        clearInterval(typeInterval);
                        bubble.classList.remove("typing");
                    }
                }, 5); // Reduce interval for HTML rendering
            } else {
                bubble.textContent = message;
                messageDiv.appendChild(bubble);
                chatBox.appendChild(messageDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        function handleSubmit() {
            const question = searchInput.value.trim();
            if (!question) return;

            if (chatBox.style.display === 'none') {
                chatBox.style.display = 'block';
            }

            addChatMessage("user", question);

            const lowerQ = question.toLowerCase();

            const thankYouKeywords = [
                // English
                "thank you",
                "thanks",
                "thank",
                "thankyou",
                "thank u",
                "thx",
                "tq",

                // Malay
                "terima kasih",
                "terimakasih",
                "terima kaseh",
                "tenkiu",
                "tqvm",
                "syukur",
                "alhamdulillah",
                "okay baik",
                "ok baik",
                "okey",
                "okey baik",
                "setel",
                "settle",
            ];

            const isThankYou = thankYouKeywords.some((kw) => lowerQ.includes(kw));

            if (isThankYou) {
                setTimeout(() => {
                    addChatMessage("bot", currentLang === 'bm' ? "Sama-sama! 😊" : "You're welcome! 😊");
                }, 500);
                searchInput.value = '';
                return;
            }

            // Fuzzy search
            const result = fuse.search(question);
            const match = result.length > 0 ? result[0].item : null;

            const reply = match ? match.jawapan[currentLang] : translations.notFound[currentLang];

            setTimeout(() => {
                addChatMessage("bot", reply);
            }, 500);

            searchInput.value = '';
        }

        // Bind event: button click
        submitBtn.addEventListener('click', handleSubmit);

        // Bind event: press Enter
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSubmit();
            }
        });

        searchInput.addEventListener("input", () => {
            const query = searchInput.value.toLowerCase().trim();
            suggestionsBox.innerHTML = "";

            if (query === "") {
                suggestionsBox.style.display = "none";
                return;
            }

            const matches = data
                .filter(d => {
                    const question = d.soalan[currentLang].toLowerCase();
                    const isExcluded = (
                        d.soalan.bm === "Apa RISDA?" && d.soalan.en === "What is RISDA?"
                    );
                    return !isExcluded && question.includes(query);
                })
                .sort((a, b) => {
                    const aText = a.soalan[currentLang].toLowerCase();
                    const bText = b.soalan[currentLang].toLowerCase();
                    const aStarts = aText.startsWith(query) ? 0 : 1;
                    const bStarts = bText.startsWith(query) ? 0 : 1;
                    return aStarts - bStarts;
                })
                .slice(0, 7); // Limit to top 7

            if (matches.length === 0) {
                // suggestionsBox.innerHTML = `<div class="suggestion-item" tabindex="0">${translations.noSuggestion[currentLang]}</div>`;
            } else {
                matches.forEach(match => {
                    const div = document.createElement("div");
                    div.className = "suggestion-item";
                    div.tabIndex = 0;
                    div.setAttribute("role", "listitem");
                    div.textContent = match.soalan[currentLang];
                    div.addEventListener("click", () => {
                        searchInput.value = "";
                        suggestionsBox.style.display = "none";

                        console.log("match soalan");
                        console.log(match.soalan[currentLang]);
                        console.log("match");
                        console.log(match.jawapan[currentLang]);
                        addChatMessage("user", match.soalan[currentLang]);
                        setTimeout(() => {
                            addChatMessage("bot", match.jawapan[currentLang]);
                        }, 500);

                    });
                    suggestionsBox.appendChild(div);
                });
            }
            suggestionsBox.style.display = "block";
        });
    </script>

</body>

</html>